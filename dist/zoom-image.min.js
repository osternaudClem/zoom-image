function ZoomImage(t){this._imgs=t,this._activeZoom=null,this.init()}function Zoom(t){this._fullHeight=0,this._fullWidth=0,this._overlay=null,this._targetImageWrap=null,this._isZoom=!1,this._initialScrollPosition=null,this._targetImage=t,this._$document=document.documentElement,this._$window=window,this._$body=document.body,this.zoomImage()}ZoomImage.prototype.init=function(){for(var t=0;t<this._imgs.length;t++){var e=this._imgs[t];zoom=new Zoom(e)}},Zoom.prototype.zoomImage=function(){var t=this,e=document.createElement("img");e.onload=function(){t._fullHeight=e.naturalHeight,t._fullWidth=e.naturalWidth,t._targetImage.setAttribute("data-action","zoom"),t._targetImage.addEventListener("click",t,!1),t._$window.addEventListener("scroll",function(e){t._scrollClose()},!1),t._$document.addEventListener("keyup",function(e){t._keyHandler(e)},!1)},e.src=this._targetImage.src},Zoom.OFFSET=80,Zoom.prototype.handleEvent=function(t){this._isZoom?this._close():this._zoomOriginal()},Zoom.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement("div"),this._targetImageWrap.className="zoom-img-wrap",this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),this._isZoom=!0,this._overlay=document.createElement("div"),this._overlay.className="zoom-overlay",document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation()},Zoom.prototype._calculateZoom=function(){this._targetImage.offsetWidth;var t=this._fullWidth,e=this._fullHeight,o=((window.pageYOffset||this._$document.scrollTop)-(this._$document.clientTop||0),t/this._targetImage.width),i=this._$document.clientHeight-Zoom.OFFSET,a=this._$document.clientWidth-Zoom.OFFSET,s=t/e,l=a/i;a>t&&i>e?this._imgScaleFactor=o:l>s?this._imgScaleFactor=i/e*o:this._imgScaleFactor=a/t*o},Zoom.prototype._triggerAnimation=function(){this._targetImage.offsetWidth;var t={top:this._targetImage.y,left:this._targetImage.x},e=(window.pageYOffset||this._$document.scrollTop)-(this._$document.clientTop||0),o=e+this._$document.clientHeight/2,i=this._$document.clientWidth/2,a=t.top+this._targetImage.height/2,s=t.left+this._targetImage.width/2;this._translateY=o-a,this._translateX=i-s;var l="scale("+this._imgScaleFactor+")",r="translate("+this._translateX+"px, "+this._translateY+"px)";this._targetImage.style.transform=l,this._targetImage.className=this._targetImage.className+" zoom-img",this._targetImageWrap.style.transform=r,this._$body.className=this._$body.className+" zoom-overlay-open"},Zoom.prototype._scrollClose=function(){if(this._isZoom){var t=(window.pageYOffset||this._$document.scrollTop)-(this._$document.clientTop||0);null===this._initialScrollPosition&&(this._initialScrollPosition=t);var e=this._initialScrollPosition-t;Math.abs(e)>=40&&this._close()}},Zoom.prototype._keyHandler=function(t){27==t.keyCode&&this._isZoom&&this._close()},Zoom.prototype._close=function(){var t=this;this._targetImageWrap.style.transform="",this._targetImage.style.transform="",this._$body.className=this._$body.className.replace("zoom-overlay-open",""),this._isZoom=!1,setTimeout(function(){t._targetImage.className=t._targetImage.className.replace("zoom-img",""),t._targetImageWrap.parentNode.replaceChild(t._targetImage,t._targetImageWrap),t._overlay.parentNode.removeChild(t._overlay),this._initialScrollPosition=null},300)};
